<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>eMenu Taipei — 行程助手</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.86);
      --card-radius: 18px;
    }
    /* 確保容器佔滿整個視窗高度 */
    html,body,#app { height:100%; } 
    body{
      font-family: 'Noto Sans TC', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background-color:#0f172a;
      margin:0;
    }
    /* hide scrollbar on WebKit */
    .no-scrollbar::-webkit-scrollbar { display:none; }
    .no-scrollbar { -ms-overflow-style:none; scrollbar-width:none; }
    /* small fade animation */
    .fade-enter-active, .fade-leave-active { transition: opacity .25s ease; }
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    /* safe bottom padding for phones: Dock會位於此空間上方 */
    .pb-safe { padding-bottom: calc(env(safe-area-inset-bottom) + 120px); } 
    
    /* 自訂類別：用於已完成的深灰色文字與刪除線 */
    .task-done {
        text-decoration: line-through;
        color: #6b7280; /* Tailwind gray-500 */
    }

    /* 🎯 調整 Dock 樣式以模擬 iPhone Dock */
    .iphone-dock {
        background: rgba(255, 255, 255, 0.6); /* 更透明 */
        backdrop-filter: blur(10px);
        border-radius: 30px; /* 更圓潤 */
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        padding: 0.75rem 1.5rem; /* 增加內邊距 */
        border: 1px solid rgba(255, 255, 255, 0.3); /* 輕微邊框 */
    }

    /* 調整 Dock 內圖標的大小 */
    .iphone-dock button i {
        font-size: 1.5rem; /* 圖標稍大 */
    }

  </style>
</head>

<body>
  <div id="app" class="relative min-h-screen flex flex-col">

    <div class="absolute inset-0 z-0 pointer-events-none">
      <img src="./IMG_6732.jpeg?auto=format&fit=crop&w=2000&q=80"
           class="w-full h-full object-cover opacity-100" alt="Taipei Night">
      <div class="absolute inset-0 bg-gradient-to-b from-slate-100/75 via-slate-100/55 to-slate-200/85"></div>
    </div>

        <main class="relative z-10 flex-1 overflow-y-auto no-scrollbar pb-safe pt-6 px-4">

      <div class="flex items-center justify-between mb-4">
        <div>
          <h1 class="text-2xl font-bold text-gray-800">eMenu Taipei <span class="ml-1 text-sm">🇹🇼</span></h1>
          <p class="text-xs text-gray-500 mt-1">台北 12/15 — 12/18</p>
        </div>
        <div class="text-right">
          <div class="text-[10px] font-bold text-emerald-700 bg-emerald-100 px-2 py-1 rounded-md border border-emerald-200 inline-block">即時匯率</div>
          <div class="text-xs font-bold text-gray-600 mt-1">
            1 TWD ≈ <span class="text-emerald-600 text-sm">{{ formattedRate }}</span> HKD
            <div class="text-[10px] text-gray-400">更新：{{ lastRateUpdateLabel }}</div>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
          <button @click="currentTab = '行前'" 
                  class="flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center text-xs font-semibold transition-transform"
                  :class="currentTab === '行前' ? 'bg-gradient-to-br from-sky-200 to-teal-100 scale-105 shadow-md text-gray-900 border border-sky-200' : 'bg-white/80 border border-white/40 text-gray-600'">
             行前
          </button>

          <button v-for="(d, i) in days" :key="i"
                  @click="selectDay(i); currentTab = '行程'"
                  class="flex-shrink-0 w-20 h-12 rounded-xl flex flex-col items-center justify-center transition-transform"
                  :class="selectedDay === i && currentTab === '行程' ? 'bg-gradient-to-br from-sky-200 to-teal-100 scale-105 shadow-md text-gray-900 border border-sky-200' : 'bg-white/80 text-gray-600 border border-white/40'">
            <span class="text-[11px]">{{ d.week }}</span>
            <span class="text-sm font-bold">{{ d.date }}</span>
          </button>
        </div>
      </div>

      <div class="space-y-4 mb-4">
        <div class="rounded-2xl p-3 bg-white/85 border border-white/30 backdrop-blur shadow">
          <div class="flex items-center justify-between">
            <div class="flex items-baseline gap-3">
              <div class="text-3xl font-bold text-gray-800">{{ weather.temp }}°</div>
              <div class="text-xs text-gray-600">
                <div class="font-medium">{{ weather.desc }}</div>
                <div class="text-[12px] text-gray-500">降雨機率 {{ weather.rain }}%</div>
              </div>
            </div>
            <div class="text-2xl text-sky-500">
              <i :class="weatherIconClass"></i>
            </div>
          </div>
        </div>

        <transition name="fade">
            <div v-if="shouldShowFlightCard" 
                 class="rounded-2xl p-4 text-white shadow-lg" 
                 style="background: linear-gradient(135deg,#60a5fa 0%,#2dd4bf 100%);">
              <div class="flex justify-between items-center mb-3">
                <div class="text-xs font-bold bg-white/20 px-2 py-1 rounded">FLIGHT</div>
                
                <div class="text-xs text-right">
                    <div class="font-mono font-semibold text-lg">{{ activeFlight.depTime }}</div>
                    <div class="text-xs opacity-80 mt-1">Arr. {{ activeFlight.arrTime }}</div>
                </div>

              </div>

              <div class="flex items-center justify-between">
                <div class="flex flex-col items-center">
                  <div class="text-[11px] opacity-80">from</div>
                  <div class="text-3xl font-bold tracking-widest">{{ activeFlight.fromCode }}</div>
                  <div class="text-sm font-semibold opacity-80 text-white/90 mt-1">{{ activeFlight.fromTerminal }}</div>
                </div>

                <div class="flex-1 px-4 text-center">
                  <i class="ph ph-airplane-tilt text-2xl"></i>
                  <div class="h-0.5 bg-white/30 my-3"></div>
                  <div class="text-xs opacity-75">{{ activeFlight.note }}</div>
                </div>

                <div class="flex flex-col items-center">
                  <div class="text-[11px] opacity-80">to</div>
                  <div class="text-3xl font-bold tracking-widest">{{ activeFlight.toCode }}</div>
                   <div class="text-sm font-semibold opacity-80 text-white/90 mt-1">{{ activeFlight.toTerminal }}</div>
                </div>
              </div>

              <div class="mt-4 flex justify-between items-center">
                <div class="text-sm">{{ activeFlight.code }} — {{ activeFlight.title }}</div>
                <div class="bg-white text-sky-600 px-3 py-1 rounded-full text-xs font-bold">已確認</div>
              </div>
            </div>
        </transition>

      </div>

      <div class="flex justify-end mb-3">
        <button @click="openAddModal" class="bg-sky-600 text-white px-4 py-2 rounded-lg shadow">+ 新增</button>
      </div>

      <div class="rounded-2xl p-3 bg-white/85 border border-white/30 backdrop-blur shadow">

        <div>
          
          <div v-if="currentTab === '行前'">
            <h3 class="text-base font-bold mb-2">✅ 行前準備清單</h3>
            <ul class="space-y-2">
              <li v-for="(note, i) in preTripNotes" :key="i" class="p-3 rounded-lg bg-white/80 border flex justify-between items-center">
                <div class="flex items-center gap-2">
                  <i class="ph text-xl cursor-pointer" 
                     :class="note.isDone ? 'ph-check-circle-fill text-emerald-500' : 'ph-circle text-gray-400'" 
                     @click="note.isDone = !note.isDone">
                  </i>
                  <span class="font-medium" :class="{'task-done': note.isDone, 'text-gray-900': !note.isDone}">{{ note.name }}</span>
                </div>
                <button class="text-red-500 text-base" @click="removePreNote(i)"><i class="ph ph-trash"></i></button>
              </li>
              <li v-if="preTripNotes.length === 0" class="p-3 text-sm text-gray-500 text-center border-dashed border-2 rounded-lg">
                請新增行前準備事項！
              </li>
            </ul>

            <div class="mt-3">
              <label class="text-xs text-gray-600">新增準備事項</label>
              <div class="flex gap-2 mt-1">
                <input v-model="newPreNote" @keyup.enter="addPreNote" class="flex-1 p-2 rounded-lg border bg-white/70" placeholder="例如：兌換台幣、購買 SIM 卡">
                <button @click="addPreNote" class="px-4 bg-sky-600 text-white rounded-lg">加入</button>
              </div>
            </div>
          </div>
          <div v-if="currentTab === '行程'">
            <h3 class="text-base font-bold mb-2">今日行程 — {{ days[selectedDay].label }}</h3>

            <ul class="space-y-2">
              <li v-for="(it, idx) in itinerary[selectedDay]" :key="idx" 
                  class="p-3 rounded-lg bg-white/80 border border-white/30 flex justify-between items-center">
                
                <div class="flex-1">
                  <div class="font-medium">{{ it.title }}</div>
                  <div class="text-xs text-gray-500">{{ it.note }}</div>
                </div>
                
                <div class="flex items-center gap-2">
                    <div class="text-sm text-gray-500 mr-2">{{ it.time || '' }}</div>
                    <button @click="removeItineraryItem(idx)" class="text-red-500 text-base hover:text-red-600 transition">
                        <i class="ph ph-trash"></i>
                    </button>
                </div>
              </li>
            </ul>

            <div class="mt-3">
              <label class="text-xs text-gray-600">加入行程</label>
              <div class="flex gap-2 mt-1">
                <input v-model="newItemText" @keyup.enter="addItineraryItem" class="flex-1 p-2 rounded-lg border bg-white/70" placeholder="輸入行程項目">
                <button @click="addItineraryItem" class="px-4 bg-sky-600 text-white rounded-lg">加入</button>
              </div>
            </div>
          </div>
          <div v-if="currentTab === '美食'">
            <h3 class="text-base font-bold mb-2">美食清單</h3>
            <ul class="space-y-2">
              <li v-for="(f,i) in foodList" :key="i" class="p-3 rounded-lg bg-white/80 border flex justify-between items-center">
                <div class="font-medium">{{ f }}</div>
                <button class="text-red-500 text-sm" @click="removeFood(i)">刪除</button>
              </li>
            </ul>

            <div class="mt-3 flex gap-2">
              <input v-model="newFood" @keyup.enter="addFood" class="flex-1 p-2 rounded-lg border bg-white/70" placeholder="新增美食">
              <button @click="addFood" class="px-4 bg-sky-600 text-white rounded-lg">加入</button>
            </div>
          </div>

          <div v-if="currentTab === '景點'">
            <h3 class="text-base font-bold mb-2">景點收藏</h3>
            <ul class="space-y-2">
              <li v-for="(s,i) in spots" :key="i" class="p-3 rounded-lg bg-white/80 border flex justify-between items-center">
                <div class="font-medium">{{ s }}</div>
                <button class="text-red-500 text-sm" @click="removeSpot(i)">刪除</button>
              </li>
            </ul>

            <div class="mt-3 flex gap-2">
              <input v-model="newSpot" @keyup.enter="addSpot" class="flex-1 p-2 rounded-lg border bg-white/70" placeholder="新增景點">
              <button @click="addSpot" class="px-4 bg-sky-600 text-white rounded-lg">加入</button>
            </div>
          </div>

          <div v-if="currentTab === '交通'">
            <h3 class="text-base font-bold mb-2">交通筆記</h3>
            <div class="text-sm text-gray-600">以計程車為主；出發前 10:30 前需休息。</div>
            <div class="mt-3 space-y-2">
              <div class="p-3 rounded-lg bg-white/80 border">預計交通：計程車 / 約 30–45 分鐘至機場</div>
              <div class="p-3 rounded-lg bg-white/80 border">機場到達建議：提前 2 小時抵達</div>
            </div>
          </div>
          
          <div v-if="currentTab === '購物'">
            <h3 class="text-base font-bold mb-2">🛒 購物清單</h3>
            <ul class="space-y-2">
              <li v-for="(item, i) in shoppingList" :key="i" class="p-3 rounded-lg bg-white/80 border flex justify-between items-center">
                <div class="flex items-center gap-2">
                  <i class="ph text-xl cursor-pointer" 
                     :class="item.isDone ? 'ph-check-circle-fill text-emerald-500' : 'ph-circle text-gray-400'" 
                     @click="item.isDone = !item.isDone">
                  </i>
                  <span class="font-medium" :class="{'task-done': item.isDone, 'text-gray-900': !item.isDone}">{{ item.name }}</span>
                </div>
                <button class="text-red-500 text-sm" @click="removeShoppingItem(i)">刪除</button>
              </li>
              <li v-if="shoppingList.length === 0" class="p-3 text-sm text-gray-500 text-center border-dashed border-2 rounded-lg">
                您的購物清單是空的！
              </li>
            </ul>

            <div class="mt-3">
              <label class="text-xs text-gray-600">新增購物項目</label>
              <div class="flex gap-2 mt-1">
                <input v-model="newShoppingItem" @keyup.enter="addShoppingItem" class="flex-1 p-2 rounded-lg border bg-white/70" placeholder="輸入項目名稱 (例如：鳳梨酥)">
                <button @click="addShoppingItem" class="px-4 bg-sky-600 text-white rounded-lg">加入</button>
              </div>
            </div>
          </div>
          </div>
      </div>

                </main>

        <nav class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-20">
      <div class="iphone-dock flex gap-6 items-center">
        <button @click="currentTab='行前'" :class="currentTab==='行前' ? 'text-sky-600' : 'text-gray-500'" title="行前"><i class="ph ph-list-checks"></i></button>
        <button @click="currentTab='行程'" :class="currentTab==='行程' ? 'text-sky-600' : 'text-gray-500'" title="行程"><i class="ph ph-map-pin"></i></button>
        <button @click="currentTab='美食'" :class="currentTab==='美食' ? 'text-sky-600' : 'text-gray-500'" title="美食"><i class="ph ph-knife"></i></button>
        <button @click="currentTab='購物'" :class="currentTab==='購物' ? 'text-sky-600' : 'text-gray-500'" title="購物"><i class="ph ph-shopping-bag"></i></button>
        <button @click="currentTab='景點'" :class="currentTab==='景點' ? 'text-sky-600' : 'text-gray-500'" title="景點"><i class="ph ph-tree"></i></button>
        <button @click="currentTab='交通'" :class="currentTab==='交通' ? 'text-sky-600' : 'text-gray-500'" title="交通"><i class="ph ph-car"></i></button>
      </div>
    </nav>
  </div>

  <script>
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

    createApp({
      setup() {
        // Top-level data
        const tabs = ['行前','行程','美食','景點','交通','購物'];
        const currentTab = ref('行前'); 

        // dates for top chips
        const days = reactive([
          { week:'Mon', date:'15', label:'12/15 (一)', type: 'flight-out' }, 
          { week:'Tue', date:'16', label:'12/16 (二)', type: 'stay' },      
          { week:'Wed', date:'17', label:'12/17 (三)', type: 'stay' },       
          { week:'Thu', date:'18', label:'12/18 (四)', type: 'flight-return'}
        ]);
        const selectedDay = ref(0);

        // itinerary prefilled (unchanged)
        const itinerary = reactive([
          [ // 12/15
            { title:'抵達台北・入住酒店、休息', note:'西門町永安棧', time:'—' },
            { title:'西門町輕鬆散步', note:'悠閒行程', time:'18:00' },
            { title:'雅香石頭火鍋（晚餐）', note:'必吃排隊店', time:'19:00' },
            { title:'南機場夜市', note:'宵夜', time:'21:00' },
            { title:'返酒店休息', note:'10:30 前休息', time:'23:00' }
          ],
          [ // 12/16
            { title:'午餐：千暉鵝肉店', note:'美食', time:'12:00' },
            { title:'Costco 中和店（續會＋買手信）', note:'購物', time:'14:00' },
            { title:'晚餐：雞湯榮麵食館（17:00 後）', note:'晚餐', time:'17:30' },
            { title:'華西街夜市', note:'逛夜市', time:'19:30' },
            { title:'胖老闆誠意肉粥（宵夜）', note:'宵夜', time:'22:00' }
          ],
          [ // 12/17
            { title:'午餐：梁山泊小籠湯包', note:'中午', time:'12:00' },
            { title:'西門町行下 / Cafe 休息', note:'悠閒午後', time:'14:00' },
            { title:'寧夏夜市', note:'晚餐自理', time:'18:30' },
            { title:'回酒店', note:'休息', time:'21:00' }
          ],
          [ // 12/18
            { title:'西門町補買手信', note:'購物', time:'11:00' },
            { title:'金園排骨（午餐）', note:'午餐', time:'13:00' },
            { title:'前往機場（CX443）', note:'搭乘 CX443 回 HKG', time:'15:50' }
          ]
        ]);

        // flights 結構 (包含抵達時間 arrTime)
        const flights = [
          { id: 'outbound', date:'2025-12-15', code:'CX400', depTime:'13:00', fromCode:'HKG', fromTerminal:'T1', toCode:'TPE', toTerminal:'T1', arrTime:'14:50', title:'由香港飛往台北', note:'航班前往台北' },
          { id: 'return', date:'2025-12-18', code:'CX443', depTime:'15:50', fromCode:'TPE', fromTerminal:'T1', toCode:'HKG', toTerminal:'T1', arrTime:'18:00', title:'由台北返回香港', note:'回程' }
        ];

        // 根據選中的日期來確定要顯示哪個航班數據（去程 or 回程）
        const activeFlight = computed(() => {
          const dayType = days[selectedDay.value].type;
          if (dayType === 'flight-out') return flights[0]; 
          if (dayType === 'flight-return') return flights[1]; 
          return null;
        });

        // 根據日期和當前 Tab 決定是否顯示航班卡片
        const shouldShowFlightCard = computed(() => {
          const dayType = days[selectedDay.
