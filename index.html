<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>行程與購物 - 修正版</title>
  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    /* 基本樣式 */
    :root{font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    html,body,#app{height:100%;margin:0;padding:0;}
    header{background:#0f172a;color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;}
    header h1{font-size:16px;margin:0;}
    .container{padding:12px;max-width:980px;margin:0 auto;}
    .day-card{background:#fff;border-radius:8px;padding:12px;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,0.06);}
    .card-row{display:flex;align-items:center;justify-content:space-between;}
    .top-right-btn{background:#2563eb;color:#fff;border:none;border-radius:6px;padding:8px 10px;font-size:14px;cursor:pointer;}
    .small-btn{padding:6px 8px;font-size:13px;border-radius:6px;border:1px solid #ccc;background:#fafafa;cursor:pointer;}
    .date-scroller{display:flex;gap:10px;overflow-x:auto;padding:8px 6px;margin-bottom:12px;}
    .date-item{min-width:86px;padding:10px;border-radius:10px;background:#f1f5f9;text-align:center;flex:0 0 auto;}

    /* 增加點圖形寬度和間距，令行動裝置顯示更舒適 */
    @media (max-width:420px){
      .date-item{min-width:110px;padding:12px;font-size:14px;}
    }

    /* modal */
    .modal-mask{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:2000;}
    .modal{background:#fff;border-radius:10px;padding:16px;max-width:480px;width:92%;box-shadow:0 8px 30px rgba(2,6,23,0.35);}
    .modal h3{margin:0 0 8px 0;}
    .modal .row{margin-bottom:8px;display:flex;gap:8px;flex-direction:column;}
    .modal input[type="text"], .modal input[type="time"], .modal textarea, .modal select{
      padding:10px;border-radius:8px;border:1px solid #ddd;font-size:16px; /* 16px 避免 iOS 自動放大 */
      outline:none;
    }
    .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px;}

    /* 修正 iOS/Safari 自動放大 */
    input,textarea,select{font-size:16px;}

    /* 購物頁 */
    .shopping-list{list-style:none;padding:0;margin:0;}
    .shopping-list li{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #f1f1f1;}
    .bottom-add{display:flex;justify-content:center;margin-top:12px;}

    /* 防止 focus 時放大 */
    *:focus{transform:none !important;}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1>行程與購物（修正版）</h1>
      <div style="display:flex;gap:8px;align-items:center;">
        <button class="small-btn" @click="openShopping">購物</button>
        <button class="small-btn" @click="openItinerary">行前總覽</button>
      </div>
    </header>

    <div class="container">
            <!-- 日期水平滾動選單 -->
      <div class="date-scroller" role="tablist" aria-label="日期選單">
        <div v-for="(d, i) in days" :key="d.id" class="date-item"
             :style="{border: currentDayIndex === i ? '2px solid #2563eb' : 'none'}"
             @click="selectDay(i)">
          <div style="font-weight:600">{{ d.label }}</div>
          <div style="font-size:12px;color:#64748b">{{ d.date }}</div>
        </div>
      </div>

      <!-- Day 卡片 -->
      <div v-for="(d,i) in days" :key="d.id" class="day-card" v-show="currentDayIndex === i">
        <div class="card-row">
          <div>
            <div style="font-weight:700">{{ d.title }}</div>
            <div style="font-size:13px;color:#6b7280">{{ d.subtitle }}</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center;">
            <!-- Day1 & Day4：右上 + 只能新增航班 -->
            <button v-if="d.hasFlights"
                    class="top-right-btn"
                    @click="openAddFlight(d)">
              + 新增航班
            </button>

            <!-- Day2 & Day3：右上 + 新增行程 -->
            <button v-else
                    class="top-right-btn"
                    @click="openAddItinerary(d)">
              + 新增行程
            </button>
          </div>
        </div>

        <!-- 航班資訊區 -->
        <div v-if="d.flights && d.flights.length" style="margin-top:10px;">
          <div v-for="f in d.flights" :key="f.id"
               style="padding:8px;border-radius:8px;background:#f8fafc;margin-bottom:6px;">
            <strong>航班</strong>：{{f.airline}} {{f.flightNo}} — {{f.time}}
          </div>
        </div>

        <!-- 行程清單 -->
        <div style="margin-top:12px;">
          <ol>
            <li v-for="(it, idx) in d.itineraries" :key="it.id" style="margin-bottom:8px;">
              <strong>{{it.time}}</strong> — {{it.title}}
              <button class="small-btn" style="margin-left:8px;" @click="editItinerary(d,it)">編輯</button>
              <button class="small-btn" @click="removeItinerary(d,it.id)">刪除</button>
            </li>
          </ol>

          <!-- Day1 & Day4：新增行程移到底部 -->
          <div v-if="d.hasFlights" class="bottom-add">
            <button class="top-right-btn" @click="openAddItinerary(d)">
              + 新增行程（底部）
            </button>
          </div>
        </div>
      </div>

      <!-- 購物頁 -->
      <div v-show="showShopping" style="margin-top:14px;">
        <div class="day-card">
          <div class="card-row">
            <div style="font-weight:700">購物清單</div>
            <!-- 已按要求移除右上「+」鍵 -->
          </div>

          <ul class="shopping-list">
            <li v-for="item in shoppingList" :key="item.id">
              <div>{{item.name}}</div>
              <div style="display:flex;gap:8px;">
                <button class="small-btn" @click="editShopping(item)">編輯</button>
                <button class="small-btn" @click="removeShoppingItem(item.id)">刪除</button>
              </div>
            </li>
          </ul>

          <div class="bottom-add">
            <button class="top-right-btn" @click="openAddShopping">+ 新增項目</button>
          </div>
        </div>
      </div>
           <!-- 行前總覽／新增／編輯 Modal -->
      <div v-if="modalVisible" class="modal-mask" @click.self="closeModal">
        <div class="modal" role="dialog" @keydown.esc="closeModal">
          <h3>{{ modalTitle }}</h3>

          <div class="row">
            <label>標題</label>
            <input type="text" v-model="form.title" placeholder="輸入標題" />
          </div>

          <div class="row">
            <label>時間</label>
            <input type="time" v-model="form.time" />
          </div>

          <div class="row">
            <label>備註</label>
            <textarea v-model="form.note" rows="3"></textarea>
          </div>

          <div class="actions">
            <button class="small-btn" @click="closeModal">取消</button>
            <button class="top-right-btn" @click="saveModal">儲存</button>
          </div>
        </div>
      </div>

    </div> <!-- container -->
  </div> <!-- #app -->

  <script>
    const { createApp, ref, reactive } = Vue;

    createApp({
      setup(){
        const days = ref([
          { id:1, label:'Day1', date:'2025-12-20', title:'出發日', subtitle:'香港 → 目的地', hasFlights:true,
            flights:[{id:1,airline:'CX',flightNo:'CX123',time:'08:30'}],
            itineraries:[{id:101,time:'12:00',title:'午餐（示範）'}]
          },
          { id:2, label:'Day2', date:'2025-12-21', title:'Day 2', subtitle:'探索行程', hasFlights:false, flights:[], itineraries:[] },
          { id:3, label:'Day3', date:'2025-12-22', title:'Day 3', subtitle:'自由活動', hasFlights:false, flights:[], itineraries:[] },
          { id:4, label:'Day4', date:'2025-12-23', title:'回程日', subtitle:'目的地 → 香港', hasFlights:true,
            flights:[{id:2,airline:'CX',flightNo:'CX890',time:'20:45'}],
            itineraries:[]
          },
        ]);

        const currentDayIndex = ref(0);
        const showShopping = ref(false);

        /* 購物清單資料 */
        const shoppingList = ref([
          {id:1,name:'鮮奶 1L'},
          {id:2,name:'牛油 200g'}
        ]);

        /* modal 控制 */
        const modalVisible = ref(false);
        const modalTitle = ref('');

        const form = reactive({
          id:null,
          title:'',
          time:'',
          note:'',
          type:'',
          parentDayId:null
        });

        function selectDay(i){
          currentDayIndex.value = i;
          showShopping.value = false;
        }

        function openShopping(){
          showShopping.value = true;
        }

        function openItinerary(){
          showShopping.value = false;
          currentDayIndex.value = 0;
        }

        /* Day1 & Day4：新增航班 */
        function openAddFlight(day){
          modalTitle.value = '新增航班';
          form.type = 'flight';
          form.parentDayId = day.id;
          form.id = null;
          form.title = '';
          form.time = '';
          form.note = '';
          modalVisible.value = true;
        }

        /* Day2 & Day3：新增行程 */
        function openAddItinerary(day){
          modalTitle.value = '新增行程';
          form.type = 'itinerary';
          form.parentDayId = day.id;
          form.id = null;
          form.title = '';
          form.time = '';
          form.note = '';
          modalVisible.value = true;
        }

        /* 購物新增 */
        function openAddShopping(){
          modalTitle.value = '新增購物項目';
          form.type = 'shopping';
          form.id = null;
          form.title = '';
          form.time = '';
          form.note = '';
          form.parentDayId = null;
          modalVisible.value = true;
        }
               /* 行程編輯 */
        function editItinerary(day, it){
          modalTitle.value = '編輯行程';
          form.type = 'itinerary';
          form.parentDayId = day.id;
          form.id = it.id;
          form.title = it.title;
          form.time = it.time;
          form.note = it.note || '';
          modalVisible.value = true;
        }

        /* 購物編輯 */
        function editShopping(item){
          modalTitle.value = '編輯購物項目';
          form.type = 'shopping';
          form.id = item.id;
          form.title = item.name;
          form.time = '';
          form.note = '';
          modalVisible.value = true;
        }

        /* 刪除行程 */
        function removeItinerary(day, id){
          if(!confirm('確定刪除此行程？')) return;
          const idx = day.itineraries.findIndex(x=>x.id===id);
          if(idx!==-1) day.itineraries.splice(idx,1);
        }

        /* 刪除購物項目 */
        function removeShoppingItem(idToRemove){
          if(!confirm('確定刪除此項目？')) return;
          const idx = shoppingList.value.findIndex(x=>x.id===idToRemove);
          if(idx!==-1) shoppingList.value.splice(idx,1);
        }

        /* 關閉 modal */
        function closeModal(){
          modalVisible.value = false;
          form.id = null;
          form.title = '';
          form.time = '';
          form.note = '';
          form.type = '';
          form.parentDayId = null;

          /* 確保無殘留放大 */
          document.documentElement.style.transform = '';
          document.body.style.transform = '';
        }

        /* 儲存 modal（航班/行程/購物） */
        function saveModal(){
          if(form.type==='shopping'){
            if(!form.title.trim()){
              alert('請輸入項目名稱');
              return;
            }

            if(form.id){
              const idx = shoppingList.value.findIndex(x=>x.id===form.id);
              if(idx!==-1) shoppingList.value[idx].name = form.title;
            } else {
              shoppingList.value.push({id:Date.now(), name: form.title});
            }

          } else if(form.type==='flight'){
            const day = days.value.find(x=>x.id===form.parentDayId);
            if(!day){ alert('找不到對應日子'); closeModal(); return; }

            if(form.id){
              const fi = day.flights.find(f=>f.id===form.id);
              if(fi){
                fi.airline = form.title;
                fi.time = form.time;
              }
            } else {
              day.flights.push({
                id: Date.now(),
                airline: form.title || '航空公司',
                flightNo: '',
                time: form.time || ''
              });
            }

          } else if(form.type==='itinerary'){
            const day = days.value.find(x=>x.id===form.parentDayId);
            if(!day){ alert('找不到對應日子'); closeModal(); return; }

            if(form.id){
              const it = day.itineraries.find(t=>t.id===form.id);
              if(it){
                it.title = form.title;
                it.time = form.time;
                it.note = form.note;
              }
            } else {
              day.itineraries.push({
                id: Date.now(),
                time: form.time || '待定',
                title: form.title || '新活動',
                note: form.note || ''
              });
            }
          }

          closeModal();
        }

        /* 防止 iOS 自動放大 */
        document.documentElement.style.webkitTextSizeAdjust = '100%';

        return {
          days, currentDayIndex, selectDay,
          showShopping, openShopping, openItinerary,
          modalVisible, modalTitle, form,
          openAddFlight, openAddItinerary, openAddShopping,
          editItinerary, editShopping,
          removeItinerary, removeShoppingItem,
          saveModal, closeModal
        };
      }
    }).mount('#app');
  </script>
</body>
</html> 
